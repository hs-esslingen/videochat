<div id="content" (mousemove)="onMousemove()">
    <div id="main">
        <div #webcams id="webcams" *ngIf="numWebcams > 0" [style.height]="screenShareUser ? webcamHeight * 100 + '%' : '99%'">
            <ng-container *ngFor="let user of users">
                <div *ngIf="user.consumers?.video != undefined" class="video-element">
                    <app-video [video]="user.consumers?.video?.track"></app-video>
                </div>
            </ng-container>
            <div *ngIf="currentUser.stream.video" class="video-element">
                <app-video [video]="currentUser.stream.video.getVideoTracks()[0]"></app-video>
            </div>
        </div>
        <div id="divider" *ngIf="screenShareUser != undefined && numWebcams > 0" (pointerdown)="startDividerDrag()"></div>
        <div
            id="screenshare"
            *ngIf="screenShareUser != undefined"
            [style.height]="numWebcams > 0 ? 'calc(' + (1 - webcamHeight) * 99 + '% - 12px)' : 'calc(' + 99 + '% - 12px)'"
        >
            <video autoplay playsinline [srcObject]="screenShareStream"></video>
        </div>

        <app-audio *ngFor="let user of users" [audio]="user.consumers?.audio?.track"></app-audio>

        <app-toolbar id="toolbar" [class.hidden]="isToolbarHidden"></app-toolbar>
    </div>

    <app-chat *ngIf="detailType === 'chat'" class="detail" [childData]="sidebarDetail" [user]="chatUser"></app-chat>
    <app-poll *ngIf="detailType === 'poll'" class="detail"></app-poll>

    <app-master
        id="master"
        (sidebarSetDetailEvent)="setSidebarDetail($event)"
        (sidebarNicknameEvent)="setNickname($event)"
        (sidebarDisconnectEvent)="disconnect()"
        (sidebarToggleAutogainEvent)="mediaService.toggleAutoGainControl()"
        [class.detail-open]="detailType != undefined"
    ></app-master>
</div>

<div id="status">
    <div id="no-user" class="infobox" *ngIf="connection.state === 1 && users != undefined && users.length === 0">
        <h2>Zur Zeit befindet sich niemand in diesem Raum</h2>
        <input type="text" readonly [value]="roomUrl" (click)="$event.target.focus(); $event.target.select()" />
    </div>
    <div id="duplicate-session" class="infobox" *ngIf="connection.duplicateSession">
        <h2>Es besteht bereits eine Verbindung zu diesem Raum</h2>
        <button class="button" (click)="reload()">Erneut Versuchen</button>
    </div>
    <div id="duplicate-session" class="infobox" *ngIf="connection.state === 3">
        <h2>Verbindung zum Server verloren</h2>
        <div class="spinner">
            <mat-spinner diameter="30"></mat-spinner>
            <span>Die Verbindung wird wiederhergestellt...</span>
        </div>
    </div>
    <div id="duplicate-session" class="infobox" *ngIf="connection.state === 0">
        <h2>Die Verbindung wird hergestellt</h2>
        <div class="spinner">
            <mat-spinner diameter="30"></mat-spinner>
            <span>Bitte Warten...</span>
        </div>
    </div>
</div>
